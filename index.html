<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Registrasi Pendakian</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background-color: #f4f6f8; padding: 2rem; }
    .container { background: #fff; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h2 { color: #2c3e50; }
  </style>
</head>
<body>
<div class="container">
  <h2 class="text-center mb-4">Form Registrasi Pendakian Gunung</h2>
  <form id="pendakianForm">
    <div class="mb-3">
      <label class="form-label">Tipe Pendaftaran</label>
      <select class="form-select" id="groupType" required>
        <option value="">-- Pilih --</option>
        <option value="0">Individu</option>
        <option value="1">Kelompok</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Tanggal Rencana Pendakian</label>
      <input type="date" class="form-control" id="date" required>
    </div>

    <div id="groupSection" style="display:none;">
      <div class="mb-3">
        <label class="form-label">Nama Grup</label>
        <input type="text" class="form-control" id="groupname">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Nama Ketua / Individu</label>
      <input type="text" class="form-control" id="hikername0" required>
    </div>

    <div class="mb-3">
      <label class="form-label">NIK</label>
      <input type="text" class="form-control" id="nik0" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email" class="form-control" id="email0" required>
    </div>

    <div class="mb-3">
      <label class="form-label">No Telp Darurat</label>
      <input type="text" class="form-control" id="phone0" required>
    </div>

    <div id="anggotaContainer" style="display:none;">
      <hr>
      <h5>Anggota Kelompok</h5>
      <div id="anggotaList"></div>
      <button type="button" class="btn btn-outline-primary mt-2" id="tambahAnggota">+ Tambah Anggota</button>
    </div>

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success">Kirim Pendaftaran</button>
    </div>
  </form>
</div>

<script>
const anggotaList = document.getElementById('anggotaList');
let anggotaCount = 0;

// Tampilkan field berdasarkan tipe pendaftaran
document.getElementById('groupType').addEventListener('change', (e) => {
  const isGroup = e.target.value === '1';
  document.getElementById('groupSection').style.display = isGroup ? 'block' : 'none';
  document.getElementById('anggotaContainer').style.display = isGroup ? 'block' : 'none';
});

// Tambah anggota baru
const tambahBtn = document.getElementById('tambahAnggota');
tambahBtn.addEventListener('click', () => {
  if (anggotaCount >= 9) return alert('Maksimal 9 anggota tambahan');
  anggotaCount++;
  const div = document.createElement('div');
  div.classList.add('border', 'p-3', 'mb-2', 'rounded');
  div.innerHTML = `
    <h6>Anggota ${anggotaCount}</h6>
    <input type="text" class="form-control mb-2" placeholder="Nama" id="hikername${anggotaCount}">
    <input type="text" class="form-control mb-2" placeholder="NIK" id="nik${anggotaCount}">
    <input type="email" class="form-control mb-2" placeholder="Email" id="email${anggotaCount}">
    <input type="text" class="form-control mb-2" placeholder="No Telp Darurat" id="phone${anggotaCount}">
  `;
  anggotaList.appendChild(div);
});

// Kirim data ke Google Sheet
const scriptURL = "https://script.google.com/macros/s/AKfycbyKgkvB9lvlKBI_SXjiGaLGpCIUijmmXKprlMdn04k6GOkLsa1BvUJlAqyfRlX127PnvQ/exec"; // ganti dengan URL Apps Script kamu

document.getElementById('pendakianForm').addEventListener('submit', e => {
  e.preventDefault();
  const groupType = document.getElementById('groupType').value;
  const data = {
    date: document.getElementById('date').value,
    groupname: groupType === '1' ? document.getElementById('groupname').value : 'null',
    hikername0: document.getElementById('hikername0').value,
    nik0: document.getElementById('nik0').value,
    email0: document.getElementById('email0').value,
    phone0: document.getElementById('phone0').value,
    group: groupType,
    members: []
  };
  for (let i = 1; i <= anggotaCount; i++) {
    data.members.push({
      name: document.getElementById(`hikername${i}`).value,
      nik: document.getElementById(`nik${i}`).value,
      email: document.getElementById(`email${i}`).value,
      phone: document.getElementById(`phone${i}`).value
    });
  }

  fetch(scriptURL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(msg => {
    alert('Pendaftaran berhasil dikirim!');
    document.getElementById('pendakianForm').reset();
  })
  .catch(err => alert('Gagal mengirim data!'));
});
</script>
</body>
</html>
